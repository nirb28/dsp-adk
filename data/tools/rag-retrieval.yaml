id: rag-retrieval
name: RAG Document Retrieval Tool
description: Retrieve relevant document chunks from RAG system using semantic search
tool_type: api
category: knowledge-retrieval

usage_instructions: |
  This tool retrieves relevant document chunks from a RAG (Retrieval Augmented Generation) system.
  
  Use this tool when you need to:
  - Find relevant information from a knowledge base
  - Get context for answering questions
  - Retrieve documents related to a query
  - Access specific document collections
  
  The tool connects to a RAG service (like dsp-rag) that uses vector similarity search
  to find the most relevant document chunks for your query.
  
  Key Parameters:
  - query: Your search question or keywords (required)
  - configuration_name: Which RAG configuration/collection to search (default: "default")
  - configuration_names: List of configurations for multi-config retrieval
  - k: Number of results to return (default: 5)
  - similarity_threshold: Minimum similarity score to filter results (0.0-1.0)
  - use_reranking: Whether to rerank results for better relevance (default: false)
  - filter: LangChain-style metadata filter for document filtering
  - filter_after_reranking: Apply threshold filtering after reranking (default: true)
  - include_metadata: Include document metadata in results (default: true)
  - query_expansion: Optional query expansion configuration
  - debug: Enable detailed logging (default: false)

parameters:
  - name: query
    type: string
    description: The search query or question to find relevant documents
    required: true
    
  - name: configuration_name
    type: string
    description: RAG configuration name (knowledge base to search)
    required: false
    default: default
    
  - name: configuration_names
    type: array
    description: List of configuration names for multi-configuration retrieval
    required: false
    
  - name: k
    type: integer
    description: Number of document chunks to retrieve
    required: false
    default: 5
    
  - name: similarity_threshold
    type: number
    description: Minimum similarity score threshold (0.0-1.0)
    required: false
    
  - name: include_metadata
    type: boolean
    description: Whether to include document metadata in results
    required: false
    default: true
    
  - name: use_reranking
    type: boolean
    description: Whether to use reranking for better relevance
    required: false
    default: false
    
  - name: include_vectors
    type: boolean
    description: Whether to include document vectors in results
    required: false
    default: false
    
  - name: config
    type: object
    description: Optional partial configuration overrides
    required: false
    
  - name: fusion_method
    type: string
    description: 'Fusion method for multi-query results: "rrf" or "simple"'
    required: false
    default: rrf
    
  - name: rrf_k_constant
    type: integer
    description: Constant for RRF (Reciprocal Rank Fusion) calculation
    required: false
    default: 60
    
  - name: filter_after_reranking
    type: boolean
    description: Whether to apply score threshold filtering after reranking
    required: false
    default: true
    
  - name: query_expansion
    type: object
    description: Optional query expansion configuration
    required: false
    
  - name: filter
    type: object
    description: 'LangChain-style metadata filter (e.g., {"source": "manual", "category": "technical"})'
    required: false
    
  - name: debug
    type: boolean
    description: Whether to log detailed request and response payloads for debugging
    required: false
    default: false

returns:
  type: object
  properties:
    success:
      type: boolean
    query:
      type: string
    configuration_name:
      type: string
    chunks:
      type: array
      items:
        type: object
        properties:
          content:
            type: string
          metadata:
            type: object
          score:
            type: number
    total_chunks:
      type: integer
    error:
      type: string

implementation:
  type: api
  
  # RAG service endpoint configuration
  endpoint: ${RAG_ENDPOINT:http://localhost:9000}/api/v1/retrieve
  method: POST
  
  headers:
    Content-Type: application/json
    Accept: application/json
    # Optional: Add authentication if RAG service requires it
    # Authorization: Bearer ${RAG_API_KEY}
  
  # Request body mapping
  body_template: |
    {
      "query": "{{query}}",
      "configuration_name": "{{configuration_name}}",
      "configuration_names": {{configuration_names}},
      "k": {{k}},
      "similarity_threshold": {{similarity_threshold}},
      "include_metadata": {{include_metadata}},
      "use_reranking": {{use_reranking}},
      "include_vectors": {{include_vectors}},
      "config": {{config}},
      "fusion_method": "{{fusion_method}}",
      "rrf_k_constant": {{rrf_k_constant}},
      "filter_after_reranking": {{filter_after_reranking}},
      "query_expansion": {{query_expansion}},
      "filter": {{filter}},
      "debug": {{debug}}
    }
  
  # Response mapping
  response_mapping:
    success: "$.success"
    chunks: "$.documents"
    total_chunks: "$.total"
    configuration_name: "$.configuration_name"
  
  # Connection settings
  timeout: 30
  retry_count: 2
  retry_delay: 1
  
  # RAG service configurations
  rag_configs:
    default:
      endpoint: ${RAG_ENDPOINT:http://localhost:9000}
      description: Default RAG configuration
      
    technical_docs:
      endpoint: ${RAG_ENDPOINT:http://localhost:9000}
      configuration_name: technical-docs
      description: Technical documentation knowledge base
      
    customer_support:
      endpoint: ${RAG_ENDPOINT:http://localhost:9000}
      configuration_name: customer-support
      description: Customer support knowledge base
      
    batch_ml_ai_basics_test:
      endpoint: ${RAG_ENDPOINT:http://localhost:9000}
      configuration_name: batch_ml_ai_basics_test
      description: ML AI Basics knowledge base, computer vision

jwt_required: false
allowed_groups: []
allowed_roles: []
rate_limit: 60

timeout: 30
retry_count: 2

tags:
  - rag
  - retrieval
  - knowledge-base
  - semantic-search
  - documents

metadata:
  provider: custom
  version: "1.0"
  service: dsp-rag
  capabilities:
    - semantic_search
    - vector_similarity
    - metadata_filtering
    - reranking
    - configurable_collections
