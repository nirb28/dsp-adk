{
  "info": {
    "name": "ADK - Image Analysis Tool (with Base64 Upload)",
    "description": "Postman collection showing how to send images directly as base64 data instead of file paths",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Upload Image - Base64 with Pre-request Script",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              "// Read image file and convert to base64",
              "const fs = require('fs');",
              "",
              "// Get image path from environment variable or use default",
              "const imagePath = pm.environment.get('image_file_path') || 'C:/temp/test.jpg';",
              "",
              "try {",
              "    const imageBuffer = fs.readFileSync(imagePath);",
              "    const base64Image = imageBuffer.toString('base64');",
              "    pm.environment.set('current_image_base64', base64Image);",
              "    ",
              "    console.log('✓ Image loaded successfully');",
              "    console.log('  Path:', imagePath);",
              "    console.log('  Size:', (imageBuffer.length / 1024).toFixed(2), 'KB');",
              "    console.log('  Base64 length:', base64Image.length, 'chars');",
              "} catch (error) {",
              "    console.error('✗ Error reading image:', error.message);",
              "    console.error('  Make sure to set image_file_path environment variable');",
              "    pm.environment.set('current_image_base64', '');",
              "}"
            ],
            "type": "text/javascript"
          }
        },
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test(\"Analysis successful\", function () {",
              "    const jsonData = pm.response.json();",
              "    pm.expect(jsonData.success).to.be.true;",
              "    pm.expect(jsonData.result.success).to.be.true;",
              "});",
              "",
              "pm.test(\"Image source is base64_data\", function () {",
              "    const jsonData = pm.response.json();",
              "    pm.expect(jsonData.result.image_source).to.eql('base64_data');",
              "});",
              "",
              "pm.test(\"Image metadata present\", function () {",
              "    const jsonData = pm.response.json();",
              "    pm.expect(jsonData.result.metadata).to.exist;",
              "    console.log('Image dimensions:', ",
              "        jsonData.result.metadata.width, 'x', ",
              "        jsonData.result.metadata.height);",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "Accept",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"arguments\": {\n    \"image_data\": \"{{current_image_base64}}\",\n    \"analysis_type\": \"general\"\n  },\n  \"mock\": false\n}"
        },
        "url": {
          "raw": "http://localhost:8100/tools/image_analysis/execute",
          "protocol": "http",
          "host": [
            "localhost"
          ],
          "port": "8100",
          "path": [
            "tools",
            "image_analysis",
            "execute"
          ]
        },
        "description": "Upload and analyze an image using base64 encoding. Set 'image_file_path' environment variable to your image path."
      },
      "response": []
    },
    {
      "name": "Upload Image - Manual Base64 (Small Test Image)",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "Accept",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"arguments\": {\n    \"image_data\": \"iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg==\",\n    \"analysis_type\": \"general\"\n  },\n  \"mock\": false\n}"
        },
        "url": {
          "raw": "http://localhost:8100/tools/image_analysis/execute",
          "protocol": "http",
          "host": [
            "localhost"
          ],
          "port": "8100",
          "path": [
            "tools",
            "image_analysis",
            "execute"
          ]
        },
        "description": "Example with a tiny 1x1 pixel PNG image encoded as base64 (for testing)"
      },
      "response": []
    },
    {
      "name": "Upload Image - Data URL Format",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "Accept",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"arguments\": {\n    \"image_data\": \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg==\",\n    \"analysis_type\": \"general\"\n  },\n  \"mock\": false\n}"
        },
        "url": {
          "raw": "http://localhost:8100/tools/image_analysis/execute",
          "protocol": "http",
          "host": [
            "localhost"
          ],
          "port": "8100",
          "path": [
            "tools",
            "image_analysis",
            "execute"
          ]
        },
        "description": "Example with data URL format (data:image/png;base64,...). The tool automatically strips the prefix."
      },
      "response": []
    },
    {
      "name": "Upload Image - Object Detection",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              "const fs = require('fs');",
              "const imagePath = pm.environment.get('image_file_path') || 'C:/temp/test.jpg';",
              "",
              "try {",
              "    const imageBuffer = fs.readFileSync(imagePath);",
              "    const base64Image = imageBuffer.toString('base64');",
              "    pm.environment.set('current_image_base64', base64Image);",
              "    console.log('✓ Image loaded for object detection');",
              "} catch (error) {",
              "    console.error('✗ Error:', error.message);",
              "    pm.environment.set('current_image_base64', '');",
              "}"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "Accept",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"arguments\": {\n    \"image_data\": \"{{current_image_base64}}\",\n    \"analysis_type\": \"object_detection\",\n    \"options\": {\n      \"confidence_threshold\": 0.5,\n      \"max_objects\": 10\n    }\n  },\n  \"mock\": false\n}"
        },
        "url": {
          "raw": "http://localhost:8100/tools/image_analysis/execute",
          "protocol": "http",
          "host": [
            "localhost"
          ],
          "port": "8100",
          "path": [
            "tools",
            "image_analysis",
            "execute"
          ]
        },
        "description": "Detect objects in uploaded image"
      },
      "response": []
    },
    {
      "name": "Upload Image - Text Extraction (OCR)",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              "const fs = require('fs');",
              "const imagePath = pm.environment.get('image_file_path') || 'C:/temp/document.jpg';",
              "",
              "try {",
              "    const imageBuffer = fs.readFileSync(imagePath);",
              "    const base64Image = imageBuffer.toString('base64');",
              "    pm.environment.set('current_image_base64', base64Image);",
              "    console.log('✓ Document image loaded for OCR');",
              "} catch (error) {",
              "    console.error('✗ Error:', error.message);",
              "    pm.environment.set('current_image_base64', '');",
              "}"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "Accept",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"arguments\": {\n    \"image_data\": \"{{current_image_base64}}\",\n    \"analysis_type\": \"text_extraction\",\n    \"options\": {\n      \"language\": \"en\"\n    }\n  },\n  \"mock\": false\n}"
        },
        "url": {
          "raw": "http://localhost:8100/tools/image_analysis/execute",
          "protocol": "http",
          "host": [
            "localhost"
          ],
          "port": "8100",
          "path": [
            "tools",
            "image_analysis",
            "execute"
          ]
        },
        "description": "Extract text from uploaded document/image"
      },
      "response": []
    },
    {
      "name": "Compare: File Path vs Base64",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"arguments\": {\n    \"image_path\": \"d:/ds/work/workspace/git/dsp-adk/data/fraud_detection/sample_checks/check_001.jpg\",\n    \"analysis_type\": \"general\"\n  },\n  \"mock\": false\n}"
        },
        "url": {
          "raw": "http://localhost:8100/tools/image_analysis/execute",
          "protocol": "http",
          "host": [
            "localhost"
          ],
          "port": "8100",
          "path": [
            "tools",
            "image_analysis",
            "execute"
          ]
        },
        "description": "For comparison: using file path instead of base64 (server-side file)"
      },
      "response": []
    }
  ],
  "variable": [
    {
      "key": "image_file_path",
      "value": "C:/temp/test.jpg",
      "type": "string"
    }
  ]
}
